<%= javascript_tag do %>


//Creating Div of Title
div_title = $("<div>", {id: "div-title", class:"container center"});


//Append Div of Title on Body
$("body").append(div_title)


// Create a Container
container = $("<div>", {class: "container"});

// Append Container to Body
$("body").append(container)


// Create a Box Container
box = $("<div>", {class: "box"});

container.append(box);

// Create a Main
main = $("<div>", {class: "main"});

box.append(main);



//Do the magical Loop

<% stack = [] %>
<% stack.push(@root)  %>

<% loop do %>

<% current_node = stack.last %>


<% if current_node.parent_opinion == nil %>
// if not parent, so it is root
parentNode = main

<% else %>
// Locate Parent Node

parentNode = $("#opinion-<%=current_node.parent_opinion.id%> > #children")


<%end%>

parentNode.append("<%= escape_javascript(render 'discussions/opinion', :opinion => current_node, :discussion => @discussion )%>");

<% stack.pop %>


<%if current_node.related_opinions.size != 0
   current_node.related_opinions.reverse.each do |opinion|

  stack.push(opinion)
  end
   end
%>

<% break if stack.empty? %>

<% end %> 

<% end %>
