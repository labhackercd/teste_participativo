// Create a new Div
discussion = $("<div>", {id: "discussions"});

// Append this div to Body
$("body").append(discussion)



//Creating Div of Title
div_title = $("<div>", {id: "div-title", class:"container center"});

//Append Div of Title on Discussion Div
discussion.append(div_title)



//Creating Text of title
tex_title = $("<h2>", {id: "title-text", class:"blue-text text-lighten-2"});

//Adding Text of Discussion
tex_title.text("<%=@discussion.title%>")


//Append Div of Title on Discussion Div
div_title.append(tex_title)





//Do the magical Loop

<% stack = [] %>
<% stack.push(@root)  %>

<% loop do %>

<% current_node = stack.last %>


<% if current_node.parent_opinion == nil %>
// if not parent, so it is root
parentNode = discussion

<% else %>
// Locate Parent Node

parentNode = $("#opinion-<%=current_node.parent_opinion.id%> > #children")


<%end%>

parentNode.append("<%= escape_javascript(render 'discussions/opinion', :opinion => current_node, :discussion => @discussion )%>");

<% stack.pop %>


<%if current_node.related_opinions.size != 0
   current_node.related_opinions.each do |opinion|

  stack.push(opinion)
  end
   end
%>

<% break if stack.empty? %>

<% end %>
